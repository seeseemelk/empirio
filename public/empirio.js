(()=>{"use strict";var t,n,e,o=function(){this.type="play"},r=function(){function t(t){this._handler=t}return t.prototype.connect=function(){var t=this;this._socket=new WebSocket("ws://"+location.host+"/socket"),this._socket.onopen=function(){return t.onOpen()},this._socket.onerror=function(n){return t.onError(n)},this._socket.onmessage=function(n){return t.onMessage(n)}},t.prototype.send=function(t){var n=JSON.stringify(t);this._socket.send(n)},t.prototype.onOpen=function(){console.log("Socket Connected"),this._handler.onOpen()},t.prototype.onError=function(t){console.log("Socket error"),this._handler.onSocketError(t.toString())},t.prototype.onMessage=function(t){var n=JSON.parse(t.data);if(n&&n.type)switch(n.type){case"error":this._handler.onError(n);break;case"start":this._handler.onStart(n)}else this._handler.onSocketError("Bad packet received")},t}(),i=function(){};!function(t){var n,e,o,r,i,s,c=function(){function t(){this.down=!1,this.dragging=!1}return t.prototype.zero=function(){this.startX=this.x,this.startY=this.y},t.prototype.dx=function(){return this.x-this.startX},t.prototype.dy=function(){return this.y-this.startY},t.prototype.distance=function(){var t=this.dx(),n=this.dy();return Math.sqrt(t*t+n*n)},t}();function a(t){n=t,e.style.display=t===s.lobby?"auto":"none",o.style.display=t===s.game?"block":"none"}t.MouseDragEvent=c,function(t){t[t.lobby=0]="lobby",t[t.game=1]="game"}(s=t.Screen||(t.Screen={})),t.init=function(t){r=new c,i=t,e=document.getElementById("menu"),o=document.getElementById("game"),a(s.lobby),window.onselectstart=function(t){return n!=s.game||(r.down=!0,t.stopPropagation(),!1)},window.onmousedown=function(t){return n!=s.game||(r.down=!0,r.startX=t.clientX,r.startY=t.clientY,!1)},window.onmouseup=function(t){return n!=s.game||(r.down=!1,r.dragging=!1,t.stopPropagation(),!1)},window.onmousemove=function(t){return n!=s.game||(r.down&&(r.x=t.clientX,r.y=t.clientY,(r.dragging||r.distance()>=8)&&(r.dragging=!0,i.onDrag(r),r.zero(),t.stopPropagation())),!1)}},t.screen=function(){return n},t.show=a}(t||(t={})),function(t){var n,e,o,r,i,s=function(){};t.State=s,t.init=function(t){i=t,n=document.getElementById("play-button"),e=document.getElementById("playername"),o=document.getElementById("colour"),r=document.getElementById("room"),n.addEventListener("click",(function(){var t=function(){var t=new s;return t.username=e.value,t.colour=o.value,""!==r.value&&(t.room=parseInt(r.value)),t}();i.onPlayClicked(t)}))},t.enablePlay=function(){n.disabled=!1},t.disablePlay=function(){n.disabled=!0}}(n||(n={})),function(t){var n,e,o;function r(){for(;n.firstChild;)n.removeChild(n.firstChild)}t.init=function(){n=document.getElementById("table-container"),e=document.getElementById("power"),o=document.getElementById("roomId")},t.clearContent=r,t.setContent=function(t){r(),n.appendChild(t)},t.setPower=function(t){e.innerText=t.toString()},t.setRoom=function(t){o.innerText="Room #"+t.toString()}}(e||(e={}));var s=function(){function t(t){this._strength=0,this._element=t}return t.prototype.setColour=function(t){this._element.style.backgroundColor=t},t.prototype.setStrength=function(t){this._strength=t,this._element.innerText=0==t?"":t.toString()},t.prototype.strength=function(){return this._strength},t.prototype.element=function(){return this._element},t}(),c=function(){function t(t,n){this._x=0,this._y=0,this._width=t,this._height=n,this._tiles=this.createTiles(),this._table=this.createTable()}return t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.show=function(){e.setContent(this._table)},t.prototype.update=function(){this._table.style.left=this._x+"px",this._table.style.top=this._y+"px"},t.prototype.onDrag=function(t){this._x+=t.dx(),this._y+=t.dy(),this.update()},t.prototype.createTiles=function(){for(var t=[],n=0;n<this._height;n++){for(var e=[],o=0;o<this._width;o++){var r=document.createElement("td");e[o]=new s(r)}t[n]=e}return t},t.prototype.createTable=function(){var t=this,n=document.createElement("table");n.style.position="absolute";for(var e=function(e){for(var r=document.createElement("tr"),i=function(n){var i=o._tiles[n][e].element();i.innerText="",i.onclick=function(){return t.clickedTile(e,n)},r.appendChild(i)},s=0;s<o._height;s++)i(s);n.appendChild(r)},o=this,r=0;r<this._width;r++)e(r);return n},t.prototype.clickedTile=function(t,n){},t}(),a=function(){function s(){this._player=new i,this._connection=new r(this)}return s.prototype.start=function(){console.log("Starting..."),t.init(this),n.init(this),e.init(),n.disablePlay(),t.show(t.Screen.lobby),this._connection.connect(),console.log("Started!")},s.prototype.onSocketError=function(t){console.log("Socket error: "+t)},s.prototype.onError=function(t){console.log("Got error: "+t.message)},s.prototype.onStart=function(n){this._player.id=n.playerId,e.setRoom(n.room),this._field=new c(n.width,n.height),this._field.show(),t.show(t.Screen.game)},s.prototype.onOpen=function(){n.enablePlay()},s.prototype.onPlayClicked=function(t){var n=new o;n.colour=t.colour,n.username=t.username,n.room=t.room,this._player.colour=t.colour,this._connection.send(n)},s.prototype.onDrag=function(t){this._field&&this._field.onDrag(t)},s}();window.onload=function(){(new a).start()}})();